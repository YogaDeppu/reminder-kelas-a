name: Cron Job Auto

on:
  schedule:
    # Jalankan setiap 5 menit
    - cron: '*/5 * * * *'
  
  # Bisa juga dijalankan manual
  workflow_dispatch:

jobs:
  cron-job:
    runs-on: ubuntu-latest
    
    steps:
    - name: Hit URL Cron Reminder
      run: |
        echo "Running cron job at $(date)"
        echo "Hitting: https://tria.page.gd/cron_reminder.php"
        
        # Curl dengan timeout dan error handling
        response=$(curl --max-time 60 \
                       --connect-timeout 30 \
                       --retry 2 \
                       --retry-delay 5 \
                       -s -w "\n%{http_code}" \
                       "https://tria.page.gd/cron_reminder.php?token=ibetyung")
        
        # Pisahkan response body dan HTTP code
        http_code=$(echo "$response" | tail -n1)
        body=$(echo "$response" | head -n-1)
        
        echo "HTTP Status: $http_code"
        echo "Response:"
        echo "$body"
        
        # Cek apakah sukses (200-299)
        if [ "$http_code" -ge 200 ] && [ "$http_code" -lt 300 ]; then
          echo "✅ Cron job completed successfully!"
          exit 0
        else
          echo "⚠️ Warning: HTTP $http_code but continuing..."
          exit 0
        fi
